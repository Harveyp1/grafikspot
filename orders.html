<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orders - The Grafik Spot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #111827, #1e1b4b, #4c1d95); background-attachment: fixed; }
        .content-card { background-color: rgba(17, 24, 39, 0.6); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .dark-input { background-color: rgba(31, 41, 55, 0.5); border-color: rgba(75, 85, 99, 1); color: white; }
        .text-logo-pink { color: #D90077; }
    </style>
</head>
<body class="text-gray-200">

    <!-- Header -->
    <header class="bg-transparent backdrop-blur-md sticky top-0 z-50">
        <div class="container mx-auto px-6 py-3 flex justify-between items-center border-b border-gray-700/50">
            <a href="index.html"><img src="https://raw.githubusercontent.com/Harveyp1/grafikspot/main/grafik-logowhite.png" alt="The Grafik Spot Logo" class="h-12 w-auto" onerror="this.onerror=null; this.src='https://placehold.co/200x50/111827/ffffff?text=The+Grafik+Spot';"></a>
            <a href="account.html" class="text-gray-300 hover:text-fuchsia-500">&larr; Back to Dashboard</a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-12">
        <div class="content-card rounded-2xl p-8 shadow-2xl">
            <h1 id="orders-title" class="text-3xl font-bold text-white mb-6"></h1>

            <!-- Admin Controls -->
            <div id="admin-controls" class="hidden md:flex justify-between items-center mb-6 gap-4">
                <input type="text" id="search-orders" class="dark-input w-full md:w-1/3 px-4 py-2 border rounded-lg" placeholder="Search by customer or order ID...">
                <select id="status-filter" class="dark-input w-full md:w-1/4 px-4 py-2 border rounded-lg">
                    <option value="all">All Statuses</option>
                    <option value="Pending">Pending</option>
                    <option value="In Production">In Production</option>
                    <option value="Completed">Completed</option>
                </select>
            </div>

            <!-- Orders Table -->
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead class="bg-gray-900/50">
                        <tr>
                            <th class="p-3">Order ID</th>
                            <th id="customer-header" class="p-3">Customer</th>
                            <th class="p-3">Date</th>
                            <th class="p-3">Service</th>
                            <th class="p-3">Status</th>
                            <th class="p-3 text-right">Total</th>
                        </tr>
                    </thead>
                    <tbody id="orders-body">
                        <!-- Order rows will be generated by JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const ordersBody = document.getElementById('orders-body');
            const ordersTitle = document.getElementById('orders-title');
            const adminControls = document.getElementById('admin-controls');
            const customerHeader = document.getElementById('customer-header');
            
            const user = JSON.parse(localStorage.getItem('loggedInUser'));

            // Sample data - in a real app, this would come from a database
            const allOrders = [
                { id: 1055, customer: 'Jane Doe', email: 'jane@email.com', date: '2025-07-01', service: 'Vinyl Banner', status: 'In Production', total: 75.00 },
                { id: 1054, customer: 'John Smith', email: 'john@email.com', date: '2025-06-30', service: 'Business Cards', status: 'Completed', total: 45.50 },
                { id: 1053, customer: 'Admin', email: 'admin@grafikspot.com', date: '2025-06-29', service: 'Embroidered Hats', status: 'Completed', total: 120.00 },
                { id: 1052, customer: 'John Smith', email: 'john@email.com', date: '2025-06-28', service: 'T-Shirts', status: 'Completed', total: 250.00 },
                { id: 1051, customer: 'Jane Doe', email: 'jane@email.com', date: '2025-06-27', service: 'Flyers', status: 'Pending', total: 60.00 },
            ];

            function renderOrders(ordersToRender) {
                ordersBody.innerHTML = '';
                if (ordersToRender.length === 0) {
                    ordersBody.innerHTML = '<tr><td colspan="6" class="text-center p-8 text-gray-400">No orders found.</td></tr>';
                    return;
                }
                ordersToRender.forEach(order => {
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-700/50';
                    let statusColor = 'text-yellow-400';
                    if (order.status === 'Completed') statusColor = 'text-green-400';
                    if (order.status === 'In Production') statusColor = 'text-blue-400';

                    row.innerHTML = `
                        <td class="p-3">#${order.id}</td>
                        <td class="p-3 customer-cell">${order.customer}</td>
                        <td class="p-3">${order.date}</td>
                        <td class="p-3">${order.service}</td>
                        <td class="p-3 font-semibold ${statusColor}">${order.status}</td>
                        <td class="p-3 text-right font-semibold">$${order.total.toFixed(2)}</td>
                    `;
                    ordersBody.appendChild(row);
                });

                if (user && user.role !== 'Admin') {
                    document.querySelectorAll('.customer-cell').forEach(cell => cell.style.display = 'none');
                }
            }

            function setupView() {
                if (user && user.role === 'Admin') {
                    ordersTitle.textContent = 'All Customer Orders';
                    adminControls.style.display = 'flex';
                    customerHeader.style.display = 'table-cell';
                    renderOrders(allOrders);
                } else if (user) { // Customer or Employee
                    ordersTitle.textContent = 'My Order History';
                    adminControls.style.display = 'none';
                    customerHeader.style.display = 'none';
                    const userOrders = allOrders.filter(order => order.email === user.email);
                    renderOrders(userOrders);
                } else {
                    // Not logged in, redirect
                    window.location.href = './account.html';
                }
            }
            
            // Event Listeners for Admin Controls
            document.getElementById('search-orders').addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const status = document.getElementById('status-filter').value;
                const filtered = allOrders.filter(order => 
                    (order.customer.toLowerCase().includes(searchTerm) || String(order.id).includes(searchTerm)) &&
                    (status === 'all' || order.status === status)
                );
                renderOrders(filtered);
            });

            document.getElementById('status-filter').addEventListener('change', (e) => {
                 const status = e.target.value;
                 const searchTerm = document.getElementById('search-orders').value.toLowerCase();
                 const filtered = allOrders.filter(order => 
                    (order.customer.toLowerCase().includes(searchTerm) || String(order.id).includes(searchTerm)) &&
                    (status === 'all' || order.status === status)
                );
                renderOrders(filtered);
            });

            setupView();
        });
    </script>
</body>
</html>
